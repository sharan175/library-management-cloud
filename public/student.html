<!DOCTYPE html>
<html>
<head>
    <title>Student Dashboard</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #74ebd5, #ACB6E5);
        }

        .header {
            background-color: #27ae60;
            color: white;
            padding: 15px;
            text-align: center;
        }

        .menu {
            background-color: #2c3e50;
            padding: 10px;
            text-align: center;
        }

        .menu button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            background-color: white;
            border-radius: 6px;
            transition: 0.3s;
        }

        .menu button:hover {
            background-color: #f2f2f2;
        }

        .content {
            padding: 20px;
            max-width: 900px;
            margin: auto;
            background: white;
            min-height: 70vh;
            border-radius: 10px;
            margin-top: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .section {
            display: none;
        }

        .active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        th {
            background: #27ae60;
            color: white;
        }
    </style>
</head>
<body>

<div class="header">
    <h2>Student Dashboard</h2>
</div>

<div class="menu">
    <button onclick="showSection('books')">ðŸ“š Available Books</button>
    <button onclick="showSection('current')">ðŸ“– Currently Borrowed</button>
    <button onclick="showSection('history')">ðŸ“œ Borrow History</button>
    <button onclick="showSection('details')">ðŸ‘¤ My Details</button>
    <button onclick="logout()">ðŸšª Logout</button>
</div>

<div class="content">

    <!-- Books -->
    <div id="books" class="section active">
        <h3>Available Books</h3>
        <table>
            <thead>
                <tr>
                    <th>Book Code</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Available</th>
                </tr>
            </thead>
            <tbody id="booksTable"></tbody>
        </table>
    </div>

    <!-- Currently Borrowed -->
    <div id="current" class="section">
        <h3>Currently Borrowed</h3>
        <table>
            <thead>
                <tr>
                    <th>Book Code</th>
                    <th>Title</th>
                    <th>Borrow Date</th>
                    <th>Return Date</th>
                </tr>
            </thead>
            <tbody id="currentTable"></tbody>
        </table>
    </div>

    <!-- History -->
    <div id="history" class="section">
        <h3>Borrow History</h3>
        <table>
            <thead>
                <tr>
                    <th>Book Code</th>
                    <th>Title</th>
                    <th>Borrow Date</th>
                    <th>Return Date</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="historyTable"></tbody>
        </table>
    </div>

    <!-- Details -->
    <div id="details" class="section">
        <h3>My Details</h3>
        <p><strong>Name:</strong> <span id="name"></span></p>
        <p><strong>Username:</strong> <span id="username"></span></p>
        <p><strong>Email:</strong> <span id="email"></span></p>
    </div>

</div>

<script>

// ================= SECTION SWITCH =================
function showSection(id) {
    document.querySelectorAll(".section").forEach(sec => {
        sec.classList.remove("active");
    });
    document.getElementById(id).classList.add("active");
}

// ================= LOAD DATA =================
async function loadProfile() {
    const response = await fetch("/student/profile");
    if (response.status === 401) {
        window.location.href = "/";
        return;
    }

    const data = await response.json();
    document.getElementById("name").innerText = data.name;
    document.getElementById("username").innerText = data.username;
    document.getElementById("email").innerText = data.email;
}

async function loadBooks() {
    const response = await fetch("/books");
    const data = await response.json();

    const table = document.getElementById("booksTable");
    table.innerHTML = "";

    data.forEach(book => {
        table.innerHTML += `
            <tr>
                <td>${book.book_code}</td>
                <td>${book.title}</td>
                <td>${book.author}</td>
                <td>${book.available_copies}</td>
            </tr>
        `;
    });
}

async function loadCurrent() {
    const response = await fetch("/student/current");
    const data = await response.json();

    const table = document.getElementById("currentTable");
    table.innerHTML = "";

    data.forEach(record => {
        table.innerHTML += `
            <tr>
                <td>${record.book_code}</td>
                <td>${record.title}</td>
                <td>${record.borrow_date}</td>
                <td>${record.return_date || ""}</td>
            </tr>
        `;
    });
}

async function loadHistory() {
    const response = await fetch("/student/history");
    const data = await response.json();

    const table = document.getElementById("historyTable");
    table.innerHTML = "";

    data.forEach(record => {
        table.innerHTML += `
            <tr>
                <td>${record.book_code}</td>
                <td>${record.title}</td>
                <td>${record.borrow_date}</td>
                <td>${record.return_date || ""}</td>
                <td>${record.returned}</td>
            </tr>
        `;
    });
}

// ================= LOGOUT =================
async function logout() {
    await fetch("/auth/logout", { method: "POST" });
    window.location.href = "/";
}

// ================= INIT =================
loadProfile();
loadBooks();
loadCurrent();
loadHistory();

</script>

</body>
</html>
